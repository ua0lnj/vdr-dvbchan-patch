diff -Nupr vdr-2.4.1/channels.c vdr-2.4.1-mod/channels.c
--- vdr-2.4.1/channels.c	2017-06-11 01:08:56.013287744 +1000
+++ vdr-2.4.1-mod/channels.c	2019-06-18 12:15:49.555931340 +1000
@@ -146,6 +146,7 @@ int cChannel::Transponder(int Frequency,
 int cChannel::Transponder(void) const
 {
   int tf = frequency;
+if(IsSat() || IsAtsc() || IsCable() || IsTerr())
   while (tf > 20000)
         tf /= 1000;
   if (IsSat()) {
@@ -867,19 +868,21 @@ void cChannels::DeleteDuplicateChannels(
   cChannelSorter *cs = ChannelSorter.First();
   while (cs) {
         cChannelSorter *Next = ChannelSorter.Next(cs);
-        if (Next && cs->channelID == Next->channelID) {
+        if (Next && cs->channelID == Next->channelID && cs->channel->Transponder() == Next->channel->Transponder() && !strcmp(cs->channel->Parameters(), Next->channel->Parameters())) {
            dsyslog("deleting duplicate channel %s", *Next->channel->ToText());
            Del(Next->channel);
            }
         cs = Next;
         }
+  channels.Save();
 }
 
 bool cChannels::Load(const char *FileName, bool AllowComments, bool MustExist)
 {
   LOCK_CHANNELS_WRITE;
   if (channels.cConfig<cChannel>::Load(FileName, AllowComments, MustExist)) {
-     channels.DeleteDuplicateChannels();
+     if (Setup.DelDupChan == 1)
+        channels.DeleteDuplicateChannels();
      channels.ReNumber();
      return true;
      }
@@ -1027,6 +1030,7 @@ const cChannel *cChannels::GetByTranspon
 bool cChannels::HasUniqueChannelID(const cChannel *NewChannel, const cChannel *OldChannel) const
 {
   tChannelID NewChannelID = NewChannel->GetChannelID();
+  if(Setup.DelDupChan == 0) return true;
   for (const cChannel *Channel = First(); Channel; Channel = Next(Channel)) {
       if (!Channel->GroupSep() && Channel != OldChannel && Channel->GetChannelID() == NewChannelID)
          return false;
@@ -1096,11 +1100,11 @@ cChannel *cChannels::NewChannel(const cC
 #define CHANNELMARKOBSOLETE "OBSOLETE"
 #define CHANNELTIMEOBSOLETE 3600 // seconds to wait before declaring a channel obsolete (in case it has actually been seen before)
 
-bool cChannels::MarkObsoleteChannels(int Source, int Nid, int Tid)
+bool cChannels::MarkObsoleteChannels(int Source, int Nid, int Tid, int Transponder)
 {
   bool ChannelsModified = false;
   for (cChannel *Channel = First(); Channel; Channel = Next(Channel)) {
-      if (time(NULL) - Channel->Seen() > CHANNELTIMEOBSOLETE && Channel->Source() == Source && Channel->Nid() == Nid && Channel->Tid() == Tid && Channel->Rid() == 0) {
+      if (time(NULL) - Channel->Seen() > CHANNELTIMEOBSOLETE && Channel->Source() == Source && Channel->Nid() == Nid && Channel->Tid() == Tid && Channel->Rid() == 0 && Channel->Transponder()==Transponder) {
          int OldShowChannelNamesWithSource = Setup.ShowChannelNamesWithSource;
          Setup.ShowChannelNamesWithSource = 0;
          if (!endswith(Channel->Name(), CHANNELMARKOBSOLETE))
diff -Nupr vdr-2.4.1/channels.h vdr-2.4.1-mod/channels.h
--- vdr-2.4.1/channels.h	2017-06-11 01:06:40.013287744 +1000
+++ vdr-2.4.1-mod/channels.h	2019-06-18 12:15:49.555931340 +1000
@@ -251,7 +251,7 @@ public:
       ///< and will be set to the current value of the list's internal state variable upon
       ///< return from this function.
   cChannel *NewChannel(const cChannel *Transponder, const char *Name, const char *ShortName, const char *Provider, int Nid, int Tid, int Sid, int Rid = 0);
-  bool MarkObsoleteChannels(int Source, int Nid, int Tid);
+  bool MarkObsoleteChannels(int Source, int Nid, int Tid, int Transponder);
   };
 
 // Provide lock controlled access to the list:
diff -Nupr vdr-2.4.1/config.c vdr-2.4.1-mod/config.c
--- vdr-2.4.1/config.c	2018-02-16 00:40:36.013287744 +1000
+++ vdr-2.4.1-mod/config.c	2019-06-18 12:15:49.555931340 +1000
@@ -440,8 +440,10 @@ cSetup::cSetup(void)
   ColorKey3 = 3;
   VideoDisplayFormat = 1;
   VideoFormat = 0;
+  DelDupChan = 1;
   UpdateChannels = 5;
   UseDolbyDigital = 1;
+  IgnoreCa = 0;
   ChannelInfoPos = 0;
   ChannelInfoTime = 5;
   OSDLeftP = 0.08;
@@ -668,8 +670,10 @@ bool cSetup::Parse(const char *Name, con
   else if (!strcasecmp(Name, "ColorKey3"))           ColorKey3          = atoi(Value);
   else if (!strcasecmp(Name, "VideoDisplayFormat"))  VideoDisplayFormat = atoi(Value);
   else if (!strcasecmp(Name, "VideoFormat"))         VideoFormat        = atoi(Value);
+  else if (!strcasecmp(Name, "DelDupChan"))          DelDupChan         = atoi(Value);
   else if (!strcasecmp(Name, "UpdateChannels"))      UpdateChannels     = atoi(Value);
   else if (!strcasecmp(Name, "UseDolbyDigital"))     UseDolbyDigital    = atoi(Value);
+  else if (!strcasecmp(Name, "IgnoreCa"))            IgnoreCa           = atoi(Value);
   else if (!strcasecmp(Name, "ChannelInfoPos"))      ChannelInfoPos     = atoi(Value);
   else if (!strcasecmp(Name, "ChannelInfoTime"))     ChannelInfoTime    = atoi(Value);
   else if (!strcasecmp(Name, "OSDLeftP"))            OSDLeftP           = atod(Value);
@@ -800,8 +804,10 @@ bool cSetup::Save(void)
   Store("ColorKey3",          ColorKey3);
   Store("VideoDisplayFormat", VideoDisplayFormat);
   Store("VideoFormat",        VideoFormat);
+  Store("DelDupChan",         DelDupChan);
   Store("UpdateChannels",     UpdateChannels);
   Store("UseDolbyDigital",    UseDolbyDigital);
+  Store("IgnoreCa",           IgnoreCa);
   Store("ChannelInfoPos",     ChannelInfoPos);
   Store("ChannelInfoTime",    ChannelInfoTime);
   Store("OSDLeftP",           OSDLeftP);
diff -Nupr vdr-2.4.1/config.h vdr-2.4.1-mod/config.h
--- vdr-2.4.1/config.h	2019-06-16 19:13:45.013287744 +1000
+++ vdr-2.4.1-mod/config.h	2019-06-18 12:15:49.555931340 +1000
@@ -311,8 +311,10 @@ public:
   int ColorKey0, ColorKey1, ColorKey2, ColorKey3;
   int VideoDisplayFormat;
   int VideoFormat;
+  int DelDupChan;
   int UpdateChannels;
   int UseDolbyDigital;
+  int IgnoreCa;
   int ChannelInfoPos;
   int ChannelInfoTime;
   double OSDLeftP, OSDTopP, OSDWidthP, OSDHeightP;
diff -Nupr vdr-2.4.1/device.c vdr-2.4.1-mod/device.c
--- vdr-2.4.1/device.c	2019-05-29 01:55:44.013287744 +1000
+++ vdr-2.4.1-mod/device.c	2019-06-18 12:15:49.555931340 +1000
@@ -247,7 +247,7 @@ cDevice *cDevice::GetDevice(const cChann
   int SlotPriority[NumCamSlots];
   int NumUsableSlots = 0;
   bool InternalCamNeeded = false;
-  if (Channel->Ca() >= CA_ENCRYPTED_MIN) {
+  if (Channel->Ca() >= CA_ENCRYPTED_MIN && !Setup.IgnoreCa) {
      for (cCamSlot *CamSlot = CamSlots.First(); CamSlot; CamSlot = CamSlots.Next(CamSlot)) {
          SlotPriority[CamSlot->Index()] = MAXPRIORITY + 1; // assumes it can't be used
          if (CamSlot->ModuleStatus() == msReady) {
diff -Nupr vdr-2.4.1/dvbdevice.c vdr-2.4.1-mod/dvbdevice.c
--- vdr-2.4.1/dvbdevice.c	2019-05-29 01:55:44.013287744 +1000
+++ vdr-2.4.1-mod/dvbdevice.c	2019-06-18 12:23:48.141024910 +1000
@@ -95,6 +95,8 @@ const tDvbParameterMap ModulationValues[
 
 #define DVB_SYSTEM_1 0 // see also nit.c
 #define DVB_SYSTEM_2 1
+#define DTMB         2
+#define ISDBT        3
 
 const tDvbParameterMap SystemValuesSat[] = {
   {   0, DVB_SYSTEM_1, "DVB-S" },
@@ -105,6 +107,8 @@ const tDvbParameterMap SystemValuesSat[]
 const tDvbParameterMap SystemValuesTerr[] = {
   {   0, DVB_SYSTEM_1, "DVB-T" },
   {   1, DVB_SYSTEM_2, "DVB-T2" },
+  {   2, DTMB, "DMB-TH" },
+  {   3, ISDBT, "ISDBT" },
   {  -1, 0, NULL }
   };
 
@@ -206,7 +210,7 @@ cDvbTransponderParameters::cDvbTranspond
 
 int cDvbTransponderParameters::PrintParameter(char *p, char Name, int Value) const
 {
-  return Value >= 0 && Value != 999 ? sprintf(p, "%c%d", Name, Value) : 0;
+  return Value >= 0 /*&& Value != 999*/ ? sprintf(p, "%c%d", Name, Value) : 0; //999 need for QAM_AUTO, same frontends can FE_CAN_QAM_AUTO only.
 }
 
 cString cDvbTransponderParameters::ToString(char Type) const
@@ -226,7 +230,8 @@ cString cDvbTransponderParameters::ToStr
   ST("  S 2")  q += PrintParameter(q, 'O', MapToUser(rollOff, RollOffValues));
   ST("  ST2")  q += PrintParameter(q, 'P', streamId);
   ST("   T2")  q += PrintParameter(q, 'Q', t2systemId);
-  ST("  ST*")  q += PrintParameter(q, 'S', MapToUser(system, SystemValuesSat)); // we only need the numerical value, so Sat or Terr doesn't matter
+  ST("  S *")  q += PrintParameter(q, 'S', MapToUser(system, SystemValuesSat));
+  ST("   T*")  q += PrintParameter(q, 'S', MapToUser(system, SystemValuesTerr));
   ST("   T*")  q += PrintParameter(q, 'T', MapToUser(transmission, TransmissionValues));
   ST("   T2")  q += PrintParameter(q, 'X', sisoMiso);
   ST("   T*")  q += PrintParameter(q, 'Y', MapToUser(hierarchy, HierarchyValues));
@@ -281,7 +286,7 @@ bool cDvbTransponderParameters::Parse(co
           case 'P': s = ParseParameter(s, streamId); break;
           case 'Q': s = ParseParameter(s, t2systemId); break;
           case 'R': polarization = 'R'; s++; break;
-          case 'S': s = ParseParameter(s, system, SystemValuesSat); break; // we only need the numerical value, so Sat or Terr doesn't matter
+          case 'S': s = ParseParameter(s, system, SystemValuesTerr); break; // we only need the numerical value, and Terr has more values than Sat
           case 'T': s = ParseParameter(s, transmission, TransmissionValues); break;
           case 'V': polarization = 'V'; s++; break;
           case 'X': s = ParseParameter(s, sisoMiso); break;
@@ -489,6 +494,8 @@ bool cDvbFrontend::QueryDeliverySystems(
      if (frontendInfo.caps & FE_CAN_QAM_64)    { numModulations++; ms = cString::sprintf("%s%s%s", *ms, **ms ? "," : "", MapToUserString(QAM_64, ModulationValues)); }
      if (frontendInfo.caps & FE_CAN_QAM_128)   { numModulations++; ms = cString::sprintf("%s%s%s", *ms, **ms ? "," : "", MapToUserString(QAM_128, ModulationValues)); }
      if (frontendInfo.caps & FE_CAN_QAM_256)   { numModulations++; ms = cString::sprintf("%s%s%s", *ms, **ms ? "," : "", MapToUserString(QAM_256, ModulationValues)); }
+//some frontends can FE_CAN_QAM_AUTO only
+     if (frontendInfo.caps & FE_CAN_QAM_AUTO)  { numModulations++; ms = cString::sprintf("%s%s%s", *ms, **ms ? "," : "", MapToUserString(QAM_AUTO, ModulationValues)); }
      if (frontendInfo.caps & FE_CAN_8VSB)      { numModulations++; ms = cString::sprintf("%s%s%s", *ms, **ms ? "," : "", MapToUserString(VSB_8, ModulationValues)); }
      if (frontendInfo.caps & FE_CAN_16VSB)     { numModulations++; ms = cString::sprintf("%s%s%s", *ms, **ms ? "," : "", MapToUserString(VSB_16, ModulationValues)); }
      if (frontendInfo.caps & FE_CAN_TURBO_FEC) { numModulations++; ms = cString::sprintf("%s%s%s", *ms, **ms ? "," : "", "TURBO_FEC"); }
@@ -516,7 +523,13 @@ static int GetRequiredDeliverySystem(con
   else if (Channel->IsSat())
      ds = Dtp->System() == DVB_SYSTEM_1 ? SYS_DVBS : SYS_DVBS2;
   else if (Channel->IsTerr())
-     ds = Dtp->System() == DVB_SYSTEM_1 ? SYS_DVBT : SYS_DVBT2;
+     switch (Dtp->System()) {
+       case DVB_SYSTEM_2: ds = SYS_DVBT2; break;
+       case DTMB:         ds = SYS_DTMB;  break;
+       case ISDBT:         ds = SYS_ISDBT;break;
+       case DVB_SYSTEM_1:
+       default:           ds = SYS_DVBT;
+     }
   else
      esyslog("ERROR: can't determine frontend type for channel %d (%s)", Channel->Number(), Channel->Name());
   return ds;
@@ -1629,7 +1642,7 @@ bool cDvbTuner::SetFrontend(void)
      tuneTimeout = DVBC_TUNE_TIMEOUT;
      lockTimeout = DVBC_LOCK_TIMEOUT;
      }
-  else if (frontendType == SYS_DVBT || frontendType == SYS_DVBT2) {
+  else if (frontendType == SYS_DVBT || frontendType == SYS_DVBT2 || frontendType == SYS_DTMB || frontendType == SYS_ISDBT) {
      // DVB-T/DVB-T2 (common parts)
      SETCMD(DTV_FREQUENCY, FrequencyToHz(channel.Frequency()));
      SETCMD(DTV_INVERSION, dtp.Inversion());
@@ -2167,7 +2180,8 @@ bool cDvbDevice::ProvidesSource(int Sour
       || type == cSource::stAtsc  && ProvidesDeliverySystem(SYS_ATSC)
       || type == cSource::stCable && (ProvidesDeliverySystem(SYS_DVBC_ANNEX_AC) || ProvidesDeliverySystem(SYS_DVBC_ANNEX_B))
       || type == cSource::stSat   && (ProvidesDeliverySystem(SYS_DVBS) || ProvidesDeliverySystem(SYS_DVBS2))
-      || type == cSource::stTerr  && (ProvidesDeliverySystem(SYS_DVBT) || ProvidesDeliverySystem(SYS_DVBT2));
+      || type == cSource::stTerr  && (ProvidesDeliverySystem(SYS_DVBT) || ProvidesDeliverySystem(SYS_DVBT2) || ProvidesDeliverySystem(SYS_DTMB)
+      || ProvidesDeliverySystem(SYS_ISDBT));
 }
 
 bool cDvbDevice::ProvidesTransponder(const cChannel *Channel) const
diff -Nupr vdr-2.4.1/eit.c vdr-2.4.1-mod/eit.c
--- vdr-2.4.1/eit.c	2019-05-22 07:25:00.013287744 +1000
+++ vdr-2.4.1-mod/eit.c	2019-06-18 12:25:23.430835344 +1000
@@ -26,10 +26,10 @@
 
 class cEIT : public SI::EIT {
 public:
-  cEIT(cSectionSyncerHash &SectionSyncerHash, int Source, u_char Tid, const u_char *Data);
+  cEIT(cSectionSyncerHash &SectionSyncerHash, int Source, u_char Tid, const u_char *Data, int Transponder = 0);
   };
 
-cEIT::cEIT(cSectionSyncerHash &SectionSyncerHash, int Source, u_char Tid, const u_char *Data)
+cEIT::cEIT(cSectionSyncerHash &SectionSyncerHash, int Source, u_char Tid, const u_char *Data, int Transponder)
 :SI::EIT(Data, false)
 {
   if (!CheckCRCAndParse())
@@ -55,7 +55,7 @@ cEIT::cEIT(cSectionSyncerHash &SectionSy
      return;
      }
   tChannelID channelID(Source, getOriginalNetworkId(), getTransportStreamId(), getServiceId());
-  cChannel *Channel = Channels->GetByChannelID(channelID, true);
+  cChannel *Channel = Channels->GetByServiceID(Source, Transponder, getServiceId());
   if (!Channel || EpgHandlers.IgnoreChannel(Channel)) {
      ChannelsStateKey.Remove(false);
      return;
@@ -253,7 +253,7 @@ cEIT::cEIT(cSectionSyncerHash &SectionSy
                  break;
             case SI::TimeShiftedEventDescriptorTag: {
                  SI::TimeShiftedEventDescriptor *tsed = (SI::TimeShiftedEventDescriptor *)d;
-                 cSchedule *rSchedule = (cSchedule *)Schedules->GetSchedule(tChannelID(Source, Channel->Nid(), Channel->Tid(), tsed->getReferenceServiceId()));
+                 cSchedule *rSchedule = (cSchedule *)Schedules->GetSchedule(tChannelID(Source, Channel->Nid(), Channel->Tid(), tsed->getReferenceServiceId()), Channel->Name());
                  if (!rSchedule)
                     break;
                  rEvent = (cEvent *)rSchedule->GetEvent(tsed->getReferenceEventId());
@@ -444,7 +444,7 @@ void cEitFilter::Process(u_short Pid, u_
   switch (Pid) {
     case 0x12: {
          if (Tid >= 0x4E && Tid <= 0x6F)
-            cEIT EIT(sectionSyncerHash, Source(), Tid, Data);
+            cEIT EIT(sectionSyncerHash, Source(), Tid, Data, Transponder());
          }
          break;
     case 0x14: {
diff -Nupr vdr-2.4.1/epg.c vdr-2.4.1-mod/epg.c
--- vdr-2.4.1/epg.c	2019-05-22 07:25:00.013287744 +1000
+++ vdr-2.4.1-mod/epg.c	2019-06-18 12:15:49.567931569 +1000
@@ -906,9 +906,10 @@ Final:
 
 cMutex cSchedule::numTimersMutex;
 
-cSchedule::cSchedule(tChannelID ChannelID)
+cSchedule::cSchedule(tChannelID ChannelID, char *Name)
 {
   channelID = ChannelID;
+  name = Name;
   events.SetUseGarbageCollector();
   numTimers = 0;
   hasRunning = false;
@@ -1147,12 +1148,13 @@ bool cSchedule::Read(FILE *f, cSchedules
            if (*s == 'C') {
               s = skipspace(s + 1);
               char *p = strchr(s, ' ');
+              char *name = strchr(s, ' ')+1;
               if (p)
                  *p = 0; // strips optional channel name
               if (*s) {
                  tChannelID channelID = tChannelID::FromString(s);
-                 if (channelID.Valid()) {
-                    if (cSchedule *p = Schedules->AddSchedule(channelID)) {
+                 if (channelID.Valid() || (channelID.Sid() && *s == 'P')) {
+                    if (cSchedule *p = Schedules->AddSchedule(channelID, name)) {
                        if (!cEvent::Read(f, p, Line))
                           return false;
                        p->Sort();
@@ -1317,24 +1319,30 @@ bool cSchedules::Read(FILE *f)
   return result;
 }
 
-cSchedule *cSchedules::AddSchedule(tChannelID ChannelID)
+cSchedule *cSchedules::AddSchedule(tChannelID ChannelID, char *name)
 {
   ChannelID.ClrRid();
-  cSchedule *p = (cSchedule *)GetSchedule(ChannelID);
+  cSchedule *p = (cSchedule *)GetSchedule(ChannelID,name);
   if (!p) {
-     p = new cSchedule(ChannelID);
+     p = new cSchedule(ChannelID, name);
      Add(p);
      }
   return p;
 }
 
-const cSchedule *cSchedules::GetSchedule(tChannelID ChannelID) const
+const cSchedule *cSchedules::GetSchedule(tChannelID ChannelID, const char *name) const
 {
   ChannelID.ClrRid();
   for (const cSchedule *p = First(); p; p = Next(p)) {
-      if (p->ChannelID() == ChannelID)
-         return p;
+      if (name && p->Name()){
+         if (p->ChannelID() == ChannelID && !strcmp(p->Name(),name))
+            return p;
+      }
+      else {
+         if (p->ChannelID() == ChannelID)
+        return p;
       }
+  }
   return NULL;
 }
 
@@ -1344,7 +1352,7 @@ const cSchedule *cSchedules::GetSchedule
   // "What's on now/next?" menus.
   static cSchedule DummySchedule(tChannelID::InvalidID);
   if (!Channel->schedule)
-     Channel->schedule = GetSchedule(Channel->GetChannelID());
+     Channel->schedule = GetSchedule(Channel->GetChannelID(), Channel->Name());
   if (!Channel->schedule)
      Channel->schedule = &DummySchedule;
   if (Channel->schedule == &DummySchedule && AddIfMissing) {
diff -Nupr vdr-2.4.1/epg.h vdr-2.4.1-mod/epg.h
--- vdr-2.4.1/epg.h	2017-05-28 22:59:20.013287744 +1000
+++ vdr-2.4.1-mod/epg.h	2019-06-18 12:15:49.567931569 +1000
@@ -151,6 +151,7 @@ class cSchedule : public cListObject  {
 private:
   static cMutex numTimersMutex; // Protects numTimers, because it might be accessed from parallel read locks
   tChannelID channelID;
+  char *name;
   cList<cEvent> events;
   cHash<cEvent> eventsHashID;
   cHash<cEvent> eventsHashStartTime;
@@ -159,7 +160,9 @@ private:
   int modified;
   time_t presentSeen;
 public:
-  cSchedule(tChannelID ChannelID);
+  const char *Name (void) const { return name; }
+  cSchedule(tChannelID ChannelID, char *Name = NULL);
+  void SetName(char *Name) { name = Name; }
   tChannelID ChannelID(void) const { return channelID; }
   bool Modified(int &State) const { bool Result = State != modified; State = modified; return Result; }
   time_t PresentSeen(void) const { return presentSeen; }
@@ -208,8 +211,8 @@ public:
   static void ResetVersions(void);
   static bool Dump(FILE *f = NULL, const char *Prefix = "", eDumpMode DumpMode = dmAll, time_t AtTime = 0);
   static bool Read(FILE *f = NULL);
-  cSchedule *AddSchedule(tChannelID ChannelID);
-  const cSchedule *GetSchedule(tChannelID ChannelID) const;
+  cSchedule *AddSchedule(tChannelID ChannelID, char *name = NULL);
+  const cSchedule *GetSchedule(tChannelID ChannelID, const char *name = NULL) const;
   const cSchedule *GetSchedule(const cChannel *Channel, bool AddIfMissing = false) const;
   };
 
diff -Nupr vdr-2.4.1/Make.config.template vdr-2.4.1-mod/Make.config.template
--- vdr-2.4.1/Make.config.template	2017-06-02 19:29:54.013287744 +1000
+++ vdr-2.4.1-mod/Make.config.template	2019-06-18 12:15:49.567931569 +1000
@@ -90,6 +90,7 @@ LIRC_DEVICE = /var/run/lirc/lircd
 ### Define if you want 'systemd' notification:
 #SDNOTIFY = 1
 
+DVBCHANPATCH = 1
 ### Fallback for plugins with old makefiles:
 ifdef PLUGIN
 CFLAGS   += -fPIC
diff -Nupr vdr-2.4.1/menu.c vdr-2.4.1-mod/menu.c
--- vdr-2.4.1/menu.c	2019-05-29 01:55:44.013287744 +1000
+++ vdr-2.4.1-mod/menu.c	2019-06-18 12:15:49.571931646 +1000
@@ -3687,6 +3687,7 @@ void cMenuSetupDVB::Setup(void)
   if (data.VideoFormat == 0)
      Add(new cMenuEditStraItem(tr("Setup.DVB$Video display format"), &data.VideoDisplayFormat, 3, videoDisplayFormatTexts));
   Add(new cMenuEditBoolItem(tr("Setup.DVB$Use Dolby Digital"),     &data.UseDolbyDigital));
+  Add(new cMenuEditBoolItem(tr("Setup.DVB$Delete duplicate channels"),       &data.DelDupChan));
   Add(new cMenuEditStraItem(tr("Setup.DVB$Update channels"),       &data.UpdateChannels, 6, updateChannelsTexts));
   Add(new cMenuEditIntItem( tr("Setup.DVB$Audio languages"),       &numAudioLanguages, 0, I18nLanguages()->Size()));
   for (int i = 0; i < numAudioLanguages; i++)
@@ -3700,6 +3701,7 @@ void cMenuSetupDVB::Setup(void)
      Add(new cMenuEditIntItem( tr("Setup.DVB$Subtitle foreground transparency"), &data.SubtitleFgTransparency, 0, 9));
      Add(new cMenuEditIntItem( tr("Setup.DVB$Subtitle background transparency"), &data.SubtitleBgTransparency, 0, 10));
      }
+  Add(new cMenuEditBoolItem(tr("Setup.DVB$Ignore common access"),       &data.IgnoreCa));
 
   SetCurrent(Get(current));
   Display();
diff -Nupr vdr-2.4.1/nit.c vdr-2.4.1-mod/nit.c
--- vdr-2.4.1/nit.c	2019-06-01 07:47:02.013287744 +1000
+++ vdr-2.4.1-mod/nit.c	2019-06-18 12:15:49.575931720 +1000
@@ -18,6 +18,8 @@
 
 #define DVB_SYSTEM_1 0 // see also dvbdevice.c
 #define DVB_SYSTEM_2 1
+#define DTMB         2
+#define ISDBT        3
 
 #define MAXNETWORKNAME Utf8BufSize(256)
 
@@ -129,7 +131,7 @@ void cNitFilter::Process(u_short Pid, u_
                     bool found = false;
                     bool forceTransponderUpdate = false;
                     for (cChannel *Channel = Channels->First(); Channel; Channel = Channels->Next(Channel)) {
-                        if (!Channel->GroupSep() && Channel->Source() == Source && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
+                        if (!Channel->GroupSep() && Channel->Source() == Source && Channel->Transponder() == Transponder() && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
                            // Preserve parameters set separately in S2SatelliteDeliverySystemDescriptor:
                            cDvbTransponderParameters dtpc(Channel->Parameters());
                            dtp.SetStreamId(dtpc.StreamId());
@@ -168,7 +170,7 @@ void cNitFilter::Process(u_short Pid, u_
             case SI::S2SatelliteDeliverySystemDescriptorTag: {
                  if (Setup.UpdateChannels >= 5) {
                     for (cChannel *Channel = Channels->First(); Channel; Channel = Channels->Next(Channel)) {
-                        if (!Channel->GroupSep() && cSource::IsSat(Channel->Source()) && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
+                        if (!Channel->GroupSep() && cSource::IsSat(Channel->Source()) && Channel->Transponder() == Transponder() && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
                            SI::S2SatelliteDeliverySystemDescriptor *sd = (SI::S2SatelliteDeliverySystemDescriptor *)d;
                            cDvbTransponderParameters dtp(Channel->Parameters());
                            dtp.SetStreamId(sd->getInputStreamIdentifier());
@@ -196,7 +198,7 @@ void cNitFilter::Process(u_short Pid, u_
                     bool found = false;
                     bool forceTransponderUpdate = false;
                     for (cChannel *Channel = Channels->First(); Channel; Channel = Channels->Next(Channel)) {
-                        if (!Channel->GroupSep() && Channel->Source() == Source && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
+                        if (!Channel->GroupSep() && Channel->Source() == Source && Channel->Transponder() == Transponder() && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
                            int transponder = Channel->Transponder();
                            if (!ISTRANSPONDER(Frequency / 1000, transponder)) {
                               for (int n = 0; n < NumFrequencies; n++) {
@@ -252,7 +254,7 @@ void cNitFilter::Process(u_short Pid, u_
                     bool found = false;
                     bool forceTransponderUpdate = false;
                     for (cChannel *Channel = Channels->First(); Channel; Channel = Channels->Next(Channel)) {
-                        if (!Channel->GroupSep() && Channel->Source() == Source && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
+                        if (!Channel->GroupSep() && Channel->Source() == Source && Channel->Transponder() == Transponder() && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
                            // Preserve parameters set separately in T2DeliverySystemDescripto:
                            cDvbTransponderParameters dtpc(Channel->Parameters());
                            dtp.SetSystem(dtpc.System());
@@ -301,7 +303,7 @@ void cNitFilter::Process(u_short Pid, u_
                         if (Setup.UpdateChannels >= 5) {
                            for (cChannel *Channel = Channels->First(); Channel; Channel = Channels->Next(Channel)) {
                                int Source = cSource::FromData(cSource::stTerr);
-                               if (!Channel->GroupSep() && Channel->Source() == Source && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
+                               if (!Channel->GroupSep() && Channel->Source() == Source && Channel->Transponder() == Transponder() && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
                                   SI::T2DeliverySystemDescriptor *td = (SI::T2DeliverySystemDescriptor *)d;
                                   int Frequency = Channel->Frequency();
                                   int SymbolRate = Channel->Srate();
@@ -339,7 +341,7 @@ void cNitFilter::Process(u_short Pid, u_
                            int lcn = LogicalChannel.getLogicalChannelNumber();
                            int sid = LogicalChannel.getServiceId();
                            for (cChannel *Channel = Channels->First(); Channel; Channel = Channels->Next(Channel)) {
-                               if (!Channel->GroupSep() && Channel->Sid() == sid && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
+                               if (!Channel->GroupSep() && Channel->Transponder() == Transponder() && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
                                   ChannelsModified |= Channel->SetLcn(lcn);
                                   break;
                                   }
@@ -357,7 +359,7 @@ void cNitFilter::Process(u_short Pid, u_
                            int lcn = HdSimulcastLogicalChannel.getLogicalChannelNumber();
                            int sid = HdSimulcastLogicalChannel.getServiceId();
                            for (cChannel *Channel = Channels->First(); Channel; Channel = Channels->Next(Channel)) {
-                               if (!Channel->GroupSep() && Channel->Sid() == sid && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
+                               if (!Channel->GroupSep() && Channel->Transponder() == Transponder() && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
                                   ChannelsModified |= Channel->SetLcn(lcn);
                                   break;
                                   }
diff -Nupr vdr-2.4.1/pat.c vdr-2.4.1-mod/pat.c
--- vdr-2.4.1/pat.c	2019-03-15 23:13:40.013287744 +1000
+++ vdr-2.4.1-mod/pat.c	2020-01-26 15:42:19.436230561 +1000
@@ -432,6 +432,9 @@ void cPatFilter::Process(u_short Pid, u_
               case 2: // STREAMTYPE_13818_VIDEO
               case 0x1B: // H.264
               case 0x24: // H.265
+              case 0x42: // AVS+
+              case 0x43: // AVS2
+              case 0xD2: // AVS2
                       Vpid = esPid;
                       Ppid = pmt.getPCRPid();
                       Vtype = stream.getStreamType();
@@ -439,6 +442,7 @@ void cPatFilter::Process(u_short Pid, u_
                       break;
               case 3: // STREAMTYPE_11172_AUDIO
               case 4: // STREAMTYPE_13818_AUDIO
+              case 0x05: // STREAMTYPE 0x44524131 DRA1
               case 0x0F: // ISO/IEC 13818-7 Audio with ADTS transport syntax
               case 0x11: // ISO/IEC 14496-3 Audio with LATM transport syntax
                       {
@@ -474,7 +478,7 @@ void cPatFilter::Process(u_short Pid, u_
                       ProcessCaDescriptors = true;
                       }
                       break;
-              case 5: // STREAMTYPE_13818_PRIVATE
+//              case 5: // STREAMTYPE_13818_PRIVATE
               case 6: // STREAMTYPE_13818_PES_PRIVATE
               //XXX case 8: // STREAMTYPE_13818_DSMCC
                       {
@@ -577,7 +581,8 @@ void cPatFilter::Process(u_short Pid, u_
                          }
                       // fall through
               case 0x83 ... 0x86: // STREAMTYPE_USER_PRIVATE
-              case 0x88 ... 0xFF: // STREAMTYPE_USER_PRIVATE
+              case 0x88 ... 0xD1: // STREAMTYPE_USER_PRIVATE
+              case 0xD3 ... 0xFF: // STREAMTYPE_USER_PRIVATE
                       {
                       char lang[MAXLANGCODE1] = { 0 };
                       bool IsAc3 = false;
diff -Nupr vdr-2.4.1/po/ru_RU.po vdr-2.4.1-mod/po/ru_RU.po
--- vdr-2.4.1/po/ru_RU.po	2018-04-10 23:22:28.013287744 +1000
+++ vdr-2.4.1-mod/po/ru_RU.po	2020-01-26 01:23:35.627452583 +1000
@@ -1057,6 +1057,9 @@ msgstr "–®–∏—Ä–æ–∫–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ –∏–
 msgid "Setup.DVB$Use Dolby Digital"
 msgstr "–í–∫–ª—é—á–∏—Ç—å Dolby Digital"
 
+msgid "Setup.DVB$Delete duplicate channels"
+msgstr "–£–¥–∞–ª—è—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã"
+
 msgid "Setup.DVB$Update channels"
 msgstr "–û–±–Ω–æ–≤–ª—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞–Ω–∞–ª–æ–≤"
 
@@ -1084,6 +1087,9 @@ msgstr "–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–µ—Ä–
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Ñ–æ–Ω–∞ —Å—É–±—Ç–∏—Ç—Ä–æ–≤"
 
+msgid "Setup.DVB$Ignore common access"
+msgstr "–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥–∏—Ä–æ–≤–∫—É"
+
 msgid "LNB"
 msgstr "–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä"
 
diff -Nupr vdr-2.4.1/remux.c vdr-2.4.1-mod/remux.c
--- vdr-2.4.1/remux.c	2019-03-15 23:13:40.013287744 +1000
+++ vdr-2.4.1-mod/remux.c	2020-01-26 15:40:00.497377940 +1000
@@ -723,12 +723,16 @@ void cPatPmtParser::ParsePmt(const uchar
            case 0x02: // STREAMTYPE_13818_VIDEO
            case 0x1B: // H.264
            case 0x24: // H.265
+           case 0x42: // AVS+
+           case 0x43: // AVS2
+           case 0xD2: // AVS2
                       vpid = stream.getPid();
                       vtype = stream.getStreamType();
                       ppid = Pmt.getPCRPid();
                       break;
            case 0x03: // STREAMTYPE_11172_AUDIO
            case 0x04: // STREAMTYPE_13818_AUDIO
+           case 0x05: // STREAMTYPE 0x44524131 DRA1
            case 0x0F: // ISO/IEC 13818-7 Audio with ADTS transport syntax
            case 0x11: // ISO/IEC 14496-3 Audio with LATM transport syntax
                       {
@@ -1610,6 +1614,61 @@ int cH265Parser::Parse(const uchar *Data
   return tsPayload.Used();
 }
 
+// --- cAVSParser -----------------------------------------------------------
+
+class cAVSParser : public cH264Parser {
+private:
+
+  enum eNalUnitType {
+    nutSeqStartCode      = 0xb0,
+    nutVidSeqEndCode     = 0xb1,
+    nutUserStartCode     = 0xb2,
+    nutPicIStartCode     = 0xb3,
+    nutUndefStartCode    = 0xb4,
+    nutExtStartCode      = 0xb5,
+    nutPicPBStartcode    = 0xb6,
+    nutVideoEditCode     = 0xb7,
+    };
+
+  int pic_found;
+public:
+  cAVSParser(void);
+  virtual int Parse(const uchar *Data, int Length, int Pid);
+  };
+
+cAVSParser::cAVSParser(void)
+:cH264Parser()
+{
+}
+
+int cAVSParser::Parse(const uchar *Data, int Length, int Pid)
+{
+  newFrame = independentFrame = false;
+  tsPayload.Setup(const_cast<uchar *>(Data), Length, Pid);
+  uchar NalUnitType;
+  if (TsPayloadStart(Data)) {
+     tsPayload.SkipPesHeader();
+     scanner = EMPTY_SCANNER;
+     }
+  for (;;) {
+      scanner = (scanner << 8) | GetByte(true);
+      if ((scanner & 0xFFFFFF00) == 0x00000100) { // NAL unit start
+         NalUnitType = scanner & 0xff;
+         if (NalUnitType == nutPicIStartCode)
+            independentFrame = true;
+         if (NalUnitType == nutPicPBStartcode || NalUnitType == nutPicIStartCode) {
+            newFrame = true;
+            tsPayload.Statistics();
+         }
+         break;
+      }
+      if (tsPayload.AtPayloadStart() // stop at any new payload start to have the buffer refilled if necessary
+         || tsPayload.Eof()) // or if we're out of data
+         break;
+      }
+  return tsPayload.Used();
+}
+
 // --- cFrameDetector --------------------------------------------------------
 
 cFrameDetector::cFrameDetector(int Pid, int Type)
@@ -1636,7 +1695,7 @@ void cFrameDetector::SetPid(int Pid, int
 {
   pid = Pid;
   type = Type;
-  isVideo = type == 0x01 || type == 0x02 || type == 0x1B || type == 0x24; // MPEG 1, 2, H.264 or H.265
+  isVideo = type == 0x01 || type == 0x02 || type == 0x1B || type == 0x24 || type == 0x42 || type == 0xD2; // MPEG 1, 2, H.264 or H.265, –°AVS or AVS2
   delete parser;
   parser = NULL;
   if (type == 0x01 || type == 0x02)
@@ -1645,7 +1704,11 @@ void cFrameDetector::SetPid(int Pid, int
      parser = new cH264Parser;
   else if (type == 0x24)
      parser = new cH265Parser;
-  else if (type == 0x03 || type == 0x04 || type == 0x06) // MPEG audio or AC3 audio
+//  else if (type == 0x42)
+//     parser = new cCAVSParser;
+  else if (type == 0xD2 || type == 0x42 || type == 0x43) //CAVS or AVS2
+     parser = new cAVSParser;
+  else if (type == 0x03 || type == 0x04 || type == 0x06 || type == 0x05) // MPEG audio or AC3 audio or DRA1
      parser = new cAudioParser;
   else if (type != 0)
      esyslog("ERROR: unknown stream type %d (PID %d) in frame detector", type, pid);
diff -Nupr vdr-2.4.1/sdt.c vdr-2.4.1-mod/sdt.c
--- vdr-2.4.1/sdt.c	2015-08-02 21:33:23.013287744 +1000
+++ vdr-2.4.1-mod/sdt.c	2019-06-18 12:15:49.575931720 +1000
@@ -62,7 +62,7 @@ void cSdtFilter::Process(u_short Pid, u_
   bool ChannelsModified = false;
   SI::SDT::Service SiSdtService;
   for (SI::Loop::Iterator it; sdt.serviceLoop.getNext(SiSdtService, it); ) {
-      cChannel *Channel = Channels->GetByChannelID(tChannelID(source, sdt.getOriginalNetworkId(), sdt.getTransportStreamId(), SiSdtService.getServiceId()));
+      cChannel *Channel = Channels->GetByServiceID(Source(), Transponder(), SiSdtService.getServiceId());
       if (!Channel)
          Channel = Channels->GetByChannelID(tChannelID(source, 0, Transponder(), SiSdtService.getServiceId()));
       if (Channel)
@@ -106,7 +106,7 @@ void cSdtFilter::Process(u_short Pid, u_
                         char *pp = compactspace(ProviderNameBuf);
                         if (Channel) {
                            ChannelsModified |= Channel->SetId(Channels, sdt.getOriginalNetworkId(), sdt.getTransportStreamId(), SiSdtService.getServiceId());
-                           if (Setup.UpdateChannels == 1 || Setup.UpdateChannels >= 3)
+                           if ((Setup.UpdateChannels == 1 || Setup.UpdateChannels >= 3) && Channel->Transponder() == Transponder())
                               ChannelsModified |= Channel->SetName(pn, ps, pp);
                            // Using SiSdtService.getFreeCaMode() is no good, because some
                            // tv stations set this flag even for non-encrypted channels :-(
@@ -170,9 +170,9 @@ void cSdtFilter::Process(u_short Pid, u_
       }
   if (sdt.getSectionNumber() == sdt.getLastSectionNumber()) {
      if (Setup.UpdateChannels == 1 || Setup.UpdateChannels >= 3) {
-        ChannelsModified |= Channels->MarkObsoleteChannels(source, sdt.getOriginalNetworkId(), sdt.getTransportStreamId());
+        ChannelsModified |= Channels->MarkObsoleteChannels(source, sdt.getOriginalNetworkId(), sdt.getTransportStreamId(), Transponder());
         if (source != Source())
-           ChannelsModified |= Channels->MarkObsoleteChannels(Source(), sdt.getOriginalNetworkId(), sdt.getTransportStreamId());
+           ChannelsModified |= Channels->MarkObsoleteChannels(Source(), sdt.getOriginalNetworkId(), sdt.getTransportStreamId(), Transponder());
         }
      }
   StateKey.Remove(ChannelsModified);
